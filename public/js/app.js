document.addEventListener("alpine:init",()=>{Alpine.data("toasts",()=>({notifications:[],displayDuration:5e3,addNotification(t){let e=Date.now();this.notifications.length>=20&&this.notifications.splice(0,this.notifications.length-19),this.notifications.push({...t,id:e})},removeNotification(t){setTimeout(()=>{this.notifications=this.notifications.filter(e=>e.id!==t)},400)}}))});function s(t){window.dispatchEvent(new CustomEvent("notify",{detail:t}))}function u(){return class{$data;$dispatch;$el;$id;$nextTick;$refs;$root;$store;$watch;destroy;name;Id;Items;ItemsFiltered;ItemActive;ItemSelected;Search;fetchItemsUrl;constructor(e,i){this.Id=i+Date.now().toString(),this.name=i,this.Items=[],this.ItemsFiltered=[],this.ItemActive=null,this.ItemSelected=null,this.Search="",this.fetchItemsUrl=e}async init(){this.$watch("Search",()=>this.SearchItems()),this.$watch("ItemSelected",e=>this.SelectItem(e)),this.Items=await(await fetch(this.fetchItemsUrl)).json()}SearchIsEmpty(){return this.Search.length==0}ItemIsActive(e){return!!(this.ItemActive&&this.ItemActive.Value==e.Value)}ClearState(){this.ItemsFiltered=[],this.ItemActive=null,this.Search=""}ItemActiveNext(){if(!this.ItemActive)return;let e=this.ItemsFiltered.indexOf(this.ItemActive);e<this.ItemsFiltered.length-1&&(this.ItemActive=this.ItemsFiltered[e+1],this.ScrollToActiveItem())}ItemActivePrevious(){if(!this.ItemActive)return;let e=this.ItemsFiltered.indexOf(this.ItemActive);e>0&&(this.ItemActive=this.ItemsFiltered[e-1],this.ScrollToActiveItem())}ScrollToActiveItem(){if(this.ItemActive){let e=document.getElementById(this.ItemActive.Value+"-"+this.Id);if(!e)return;let i=e.offsetTop+e.offsetHeight-this.$refs.ItemsList.offsetHeight;i>0?this.$refs.ItemsList.scrollTop=i:this.$refs.ItemsList.scrollTop=0}}SearchItems(){if(this.SearchIsEmpty()){this.ClearState();return}if(!this.SearchIsEmpty()){let e=this.Search.replace(/\*/g,"").toLowerCase();this.ItemsFiltered=this.Items.filter(i=>i.Label.toLowerCase().includes(e)),this.ScrollToActiveItem()}}SelectItem(e){e&&(this.$dispatch(`searchbox-item-selected-${this.name}`,{item:e}),this.ClearState())}AddItem(){if(this.SearchIsEmpty())return;let e={Label:this.Search,Value:this.Search};this.Items.push(e),this.$dispatch(`searchbox-item-selected-${this.name}`,{item:e}),this.ClearState()}}}document.addEventListener("alpine:init",()=>{let t=(e,i)=>{let o=u();return new o(e,i)};Alpine.data("SearchBox",t)});window.addEventListener("htmx:responseError",t=>{t.detail.xhr.status===500&&s({variant:"error",title:"Error del servidor",message:"Ha ocurrido un error inesperado. Por favor intenta de nuevo."})});var c=async t=>{try{await navigator.clipboard.writeText(t),s({variant:"error",title:"Copiado!",message:"El codigo ha sido copiado al portapapeles."})}catch(e){console.error("Failed to copy: ",e)}},g=async t=>{let e={title:"Comparte la alegria!",text:`Utiliza este codigo para obtener un regalo: ${t}`,url:`${window.location.origin}/catalog?code=${t}`};try{await navigator.share(e)}catch(i){console.error("Share failed: ",i)}};globalThis.copyCode=c;globalThis.shareCode=async t=>{typeof navigator.share>"u"?c(t):g(t)};function f(t,e){let i;return function(...o){i&&clearTimeout(i),i=setTimeout(()=>{t.apply(this,o)},e)}}var m=f;var n=()=>document.getElementsByName("category[]"),d=t=>{t.delete("page");let e=t.toString();window.location.replace(`${window.location.pathname}?${e}`)},I=()=>{let t=document.getElementsByName("age_min")[0],e=document.getElementsByName("age_max")[0];return{ageMin:t.value,ageMax:e.value}},h=()=>{let t=n(),i=Array.from(t).filter(r=>r.checked).map(r=>r.value),o=new URLSearchParams(window.location.search);if(o.delete("category"),o.delete("age_min"),o.delete("age_max"),i.length>0)for(let r of i)o.append("category",r);let{ageMin:a,ageMax:l}=I();parseInt(a,10)>1&&o.set("age_min",a),parseInt(l,10)>1&&o.set("age_max",l),d(o)},v=()=>{let t=n();for(let i of t)i.checked=!1;let e=new URLSearchParams(window.location.search);e.delete("category"),e.delete("age_min"),e.delete("age_max"),d(e)},S=t=>{let e=n();if(t==="age_min"){let i=document.getElementsByName("age_min")[0];i.value="0"}else if(t==="age_max"){let i=document.getElementsByName("age_max")[0];i.value="0"}for(let i of e)i.value===t&&(i.checked=!1);h()},x=()=>{let t=new URLSearchParams(window.location.search),e=n();if(t.has("category")){let i=t.getAll("category");for(let o of e)i.includes(o.value)&&(o.checked=!0)}};globalThis.updateFilters=h;globalThis.clearFilters=v;globalThis.removeFilter=S;x();var y=()=>{document.body.scrollTop>300||document.documentElement.scrollTop>300?window.dispatchEvent(new CustomEvent("showbacktotopbtn")):window.dispatchEvent(new CustomEvent("hidebacktotopbtn"))},T=m(y,250);window.addEventListener("scroll",T);if(typeof gsap<"u"){gsap.registerPlugin(ScrollTrigger);for(let t=1;t<=3;t++)gsap.to(`#home-ilustracion-${t}`,{scrollTrigger:{trigger:`#home-ilustracion-${t}`,toggleActions:"play pause resume reset",start:"top 80%"},duration:1,opacity:1})}function p(){return document.getElementById("code").value.toUpperCase().trim().length>5}function A(t){p()||t.preventDefault()}document.addEventListener("alpine:init",()=>{Alpine.data("codeForm",()=>({valid:!0,init(){this.valid=!0},submit(t){this.valid=p(),t.preventDefault(),t.stopPropagation()},update(){let t=document.getElementById("code"),e=t.value.toUpperCase().trim();t.value=e,e.length>5&&(this.valid=!0)}}))});globalThis.beforeRequestHandler=A;
